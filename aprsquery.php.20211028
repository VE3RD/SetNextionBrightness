#!/usr/bin/php
<?php

$lat = 0;
$lng = 0;
// $err = false;
global $err;

function customError($errno, $errstr) {
  global $lat, $lng;
	$config2 = parse_ini_file('/etc/mmdvmhost', true);
	$lat = $config2['Info']['Latitude']; 
	$lng = $config2['Info']['Longitude']; 
	echo "".$lat." ".$lng."\n";
}

set_error_handler("customError");

function display_APRS() { 
  global $lat, $lng;
	$config = parse_ini_file('/etc/nextionbrightness', true); 
	$apik = $config['General']['ApiKey']; 
	$call = $config['General']['Call'];

	$json_url = "http://api.aprs.fi/api/get?apikey=${apik}&name=${call}&what=loc&format=json";
	$json = file_get_contents( $json_url, 0, null, null );
	
//	echo "Test1";
//	echo $json_url;

		$json_output = json_decode( $json, true);
		$station_array = $json_output[ 'entries' ];
		$station = $station_array[0];
//	foreach ( $station_array as $station ) {
		$lat = $station[ 'lat' ];
		$lng = $station[ 'lng' ];
//		echo "".$lat." ".$lng."\n";
//	}
	
}

function getlatlonfrommmdvm(){
  global $lat, $lng;
	$config2 = parse_ini_file('/etc/mmdvmhost', true);
	$lat = $config2['Info']['Latitude']; 
	$lng = $config2['Info']['Longitude']; 
//	echo "".$lat." ".$lng."\n";
// echo "mmdvmhost\n";
}

display_APRS();


?>
